<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="intranet.teamone.mapper.HSMApprovalInterface">
	
	<select id="getApprovalList" parameterType="intranet.teamone.bean.ApprovalBean" resultType="intranet.teamone.bean.ApprovalBean">
		SELECT AP_CODE, AP_OSCODE, AP_DATE, CG_TYPE, CG_NAME, DP_NAME, OF_NAME
		FROM AP INNER JOIN CG ON AP.AP_CGTYPE = CG.CG_TYPE
        		INNER JOIN DP ON AP.AP_FROMDPCODE = DP.DP_CODE  AND AP.AP_FROMOFCODE = DP.DP_OFCODE 
				INNER JOIN "OF" ON AP.AP_FROMOFCODE = "OF".OF_CODE
		WHERE AP_TODPCODE = #{ap_todpcode} AND AP_TOOFCODE = #{ap_toofcode} AND AP_ATCODE = 'OR' OR
			  AP_TODPCODE = #{ap_todpcode} AND AP_TOOFCODE = #{ap_toofcode} AND AP_ATCODE = 'RR'
	</select>
	
	
	<select id="getApprovalDetail" parameterType="intranet.teamone.bean.ApprovalBean" resultType="intranet.teamone.bean.ProductBean">
		SELECT OD_CODE AS PR_CODE, OD_QUANTITY AS PR_STOCK, OD_PRICE AS PR_PRICE
		FROM OD WHERE OD_OSCODE = #{ap_oscode}
	</select>
	
	<update id="responseAppovalRefuse" parameterType="intranet.teamone.bean.ApprovalBean">
		UPDATE AP SET AP_ATCODE= #{at_code} WHERE AP_CODE = #{ap_code}
	</update>
	
	<select id="getSendApprovalList" parameterType="intranet.teamone.bean.ApprovalBean" resultType="intranet.teamone.bean.ApprovalBean">
		SELECT AP_CODE, AP_OSCODE, AP_DATE, CG_NAME, DP_NAME, OF_NAME, AT_NAME, CG_TYPE
		FROM AP INNER JOIN CG ON AP.AP_CGTYPE = CG.CG_TYPE
        		INNER JOIN DP ON AP.AP_TODPCODE = DP.DP_CODE  AND AP.AP_TOOFCODE = DP.DP_OFCODE 
				INNER JOIN "OF" ON AP.AP_TOOFCODE = "OF".OF_CODE
                INNER JOIN AT ON AP.AP_ATCODE = AT.AT_CODE
		WHERE AP_FROMDPCODE = #{ap_fromdpcode} AND AP_FROMOFCODE = #{ap_fromofcode}
	</select>
	
</mapper>